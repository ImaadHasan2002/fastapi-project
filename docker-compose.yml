services:
    backend:
        build:
            context: .
            dockerfile: backend/Dockerfile
        ports:
            - '8000:8000'
        env_file:
            - .env
        environment:
            - MODEL_PATH=models/model.pkl
        healthcheck:
            test: ['CMD', 'python', '-c', 'import urllib.request; urllib.request.urlopen("http://localhost:8000/health")']
            interval: 30s
            timeout: 5s
            retries: 3

    frontend:
        build:
            context: .
            dockerfile: frontend/Dockerfile
        ports:
            - '8501:8501'
        environment:
            - API_URL=http://backend:8000/predict
        depends_on:
            backend:
                condition: service_healthy
